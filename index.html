<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° | ‡∏†.‡∏à‡∏ß.‡∏™‡∏á‡∏Ç‡∏•‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --border: #e2e8f0;
        }

        body {
            font-family: 'Prompt', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            color: var(--dark);
        }

        /* Navbar */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .logo-text p {
            font-size: 0.875rem;
            color: #64748b;
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: #64748b;
            font-weight: 500;
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.3s;
            font-family: 'Prompt', sans-serif;
        }

        .nav-tab:hover {
            background: var(--light);
            color: var(--primary);
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Rooms Grid */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 1.5rem;
        }

        /* Room Card */
        .room-card {
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .room-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .room-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-name {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .room-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
            backdrop-filter: blur(10px);
        }

        .room-body {
            padding: 1.5rem;
        }

        /* Form */
        .form-section {
            margin-bottom: 1.5rem;
        }

        .form-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
            margin-bottom: 0.5rem;
        }

        .required {
            color: var(--danger);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-family: 'Prompt', sans-serif;
            font-size: 0.9375rem;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        /* Button */
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-family: 'Prompt', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Meeting List */
        .meetings-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--border);
        }

        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .meetings-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .meetings-list::-webkit-scrollbar {
            width: 6px;
        }

        .meetings-list::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }

        .meetings-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .meeting-item {
            background: var(--light);
            padding: 1rem;
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .meeting-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }

        .meeting-title {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.0625rem;
            flex: 1;
            margin-right: 0.5rem;
        }

        .meeting-info {
            display: grid;
            gap: 0.5rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: #475569;
        }

        .info-icon {
            font-size: 1rem;
        }

        .meeting-description {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.6;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #94a3b8;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Alert */
        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9375rem;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--danger);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalZoom 0.3s ease;
        }

        @keyframes modalZoom {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--danger);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-body {
            color: #475569;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        /* Summary Page */
        .summary-container {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .summary-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .summary-header h2 {
            font-size: 2rem;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .summary-header p {
            color: #64748b;
        }

        .week-section {
            margin-bottom: 2rem;
            background: var(--light);
            border-radius: 0.75rem;
            padding: 1.5rem;
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .week-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .week-count {
            background: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.875rem;
        }

        .day-group {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .day-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.75rem;
            font-size: 1.0625rem;
        }

        .summary-meeting {
            background: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--primary);
        }

        .summary-meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.5rem;
        }

        .summary-meeting-title {
            font-weight: 600;
            color: var(--dark);
        }

        .summary-room-badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }

            .navbar-content {
                flex-direction: column;
                gap: 1rem;
            }

            .logo-text h1 {
                font-size: 1.25rem;
            }

            .nav-tabs {
                width: 100%;
                justify-content: center;
            }

            .container {
                padding: 0 1rem;
            }

            .rooms-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <div class="logo-icon">üèõÔ∏è</div>
                <div class="logo-text">
                    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h1>
                    <p>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏†‡∏π‡∏ò‡∏£‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏á‡∏Ç‡∏•‡∏≤</p>
                </div>
            </div>
            <div class="nav-tabs">
                <button class="nav-tab active" data-tab="booking">üìÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button>
                <button class="nav-tab" data-tab="summary">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
            </div>
        </div>
    </nav>

    <!-- Container -->
    <div class="container">
        <!-- Booking Tab -->
        <div id="booking-tab" class="tab-content active">
            <div class="rooms-grid" id="roomsGrid"></div>
        </div>

        <!-- Summary Tab -->
        <div id="summary-tab" class="tab-content">
            <div class="summary-container">
                <div class="summary-header">
                    <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h2>
                    <p>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>‚ö†Ô∏è</span> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
            </div>
            <div class="modal-body">
                ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?<br>
                ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="btnCancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-danger" id="btnConfirm">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        const API_URL = 'https://script.google.com/macros/s/AKfycbwHt6vBpR29hCehcrjsAM7U7LRhpYHTWmQXKeL4GyORXxJGhMDBX7-q0nSlwB-JhaL2/exec';
        
        const ROOMS = [
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏°‡∏¥‡∏´‡∏•‡∏≤',
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°204',
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°3',
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°2'
        ];

        // ==========================================
        // DATA MANAGEMENT
        // ==========================================
        
        let meetingsData = {};
        
        // Initialize data structure
        ROOMS.forEach(room => meetingsData[room] = []);

        // Load all meetings from server
        async function loadMeetings() {
            try {
                const url = `${API_URL}?action=getAllMeetings&_=${Date.now()}`;
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    // Organize by room
                    ROOMS.forEach(room => meetingsData[room] = []);
                    
                    if (Array.isArray(result.data)) {
                        result.data.forEach(meeting => {
                            if (meetingsData[meeting.room]) {
                                meetingsData[meeting.room].push(meeting);
                            }
                        });
                    }
                    
                    return true;
                }
                
                throw new Error(result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ');
            } catch (error) {
                console.error('Load error:', error);
                return false;
            }
        }

        // Add meeting
        async function addMeeting(roomName, data) {
            try {
                const params = new URLSearchParams({
                    action: 'addMeeting',
                    data: JSON.stringify({
                        room: roomName,
                        title: data.title,
                        chairman: data.chairman,
                        date: data.date,
                        timeStart: data.timeStart,
                        description: data.description
                    }),
                    _: Date.now()
                });
                
                const response = await fetch(`${API_URL}?${params.toString()}`);
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message);
                }
                
                await loadMeetings();
                return true;
            } catch (error) {
                throw error;
            }
        }

        // Delete meeting
        async function deleteMeeting(roomName, meetingId) {
            try {
                const params = new URLSearchParams({
                    action: 'deleteMeeting',
                    data: JSON.stringify({
                        room: roomName,
                        id: meetingId
                    }),
                    _: Date.now()
                });
                
                const response = await fetch(`${API_URL}?${params.toString()}`);
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message);
                }
                
                await loadMeetings();
                return true;
            } catch (error) {
                throw error;
            }
        }

        // Check overlap
        function checkOverlap(roomName, date, time, excludeId = null) {
            const meetings = meetingsData[roomName] || [];
            
            for (let meeting of meetings) {
                if (excludeId && meeting.id === excludeId) continue;
                if (meeting.date === date && meeting.timeStart === time) {
                    return meeting;
                }
            }
            
            return null;
        }

        // ==========================================
        // UI HELPERS
        // ==========================================
        
        function showAlert(roomName, message, type = 'success') {
            const alertDiv = document.getElementById(`alert-${roomName}`);
            const icon = type === 'success' ? '‚úÖ' : '‚ùå';
            const className = type === 'success' ? 'alert-success' : 'alert-error';
            
            alertDiv.innerHTML = `
                <div class="alert ${className}">
                    <span>${icon}</span>
                    <span>${message}</span>
                </div>
            `;
        }

        function clearAlert(roomName) {
            const alertDiv = document.getElementById(`alert-${roomName}`);
            alertDiv.innerHTML = '';
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const days = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            const months = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô',
                           '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
            
            return `‡∏ß‡∏±‡∏ô${days[date.getDay()]}‡∏ó‡∏µ‡πà ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear() + 543}`;
        }

        function formatShortDate(dateStr) {
            const date = new Date(dateStr);
            const months = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.',
                           '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear() + 543}`;
        }

        // ==========================================
        // RENDER FUNCTIONS
        // ==========================================
        
        function renderRooms() {
            const grid = document.getElementById('roomsGrid');
            
            grid.innerHTML = ROOMS.map(room => `
                <div class="room-card">
                    <div class="room-header">
                        <div class="room-name">${room}</div>
                        <div class="room-badge" id="count-${room}">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                    </div>
                    <div class="room-body">
                        <div id="alert-${room}"></div>
                        
                        <div class="form-section">
                            <div class="form-title">
                                <span>‚ûï</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÉ‡∏´‡∏°‡πà
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="required">*</span></label>
                                <input type="text" class="form-input" id="title-${room}" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="required">*</span></label>
                                <input type="text" class="form-input" id="chairman-${room}" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="required">*</span></label>
                                <input type="date" class="form-input" id="date-${room}">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á <span class="required">*</span></label>
                                    <select class="form-select" id="hour-${room}">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                        ${Array.from({length: 24}, (_, i) => {
                                            const h = i.toString().padStart(2, '0');
                                            return `<option value="${h}">${h}</option>`;
                                        }).join('')}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">‡∏ô‡∏≤‡∏ó‡∏µ <span class="required">*</span></label>
                                    <select class="form-select" id="minute-${room}">
                                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
                                        <option value="00">00</option>
                                        <option value="30">30</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                                <textarea class="form-textarea" id="desc-${room}" placeholder="‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°, ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°, ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"></textarea>
                            </div>
                            
                            <button class="btn btn-primary" data-room="${room}">
                                <span>‚ûï</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
                            </button>
                        </div>
                        
                        <div class="meetings-section">
                            <div class="section-title">
                                <span>üìã</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
                            </div>
                            <div class="meetings-list" id="list-${room}"></div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners
            grid.querySelectorAll('.btn-primary').forEach(btn => {
                btn.addEventListener('click', handleAddMeeting);
            });
            
            renderAllMeetings();
        }

        function renderMeetings(roomName) {
            const list = document.getElementById(`list-${roomName}`);
            const count = document.getElementById(`count-${roomName}`);
            const meetings = meetingsData[roomName] || [];
            
            count.textContent = `${meetings.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
            
            if (meetings.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìÖ</div>
                        <div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</div>
                    </div>
                `;
                return;
            }
            
            // Sort by date and time
            meetings.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.timeStart);
                const dateB = new Date(b.date + ' ' + b.timeStart);
                return dateA - dateB;
            });
            
            list.innerHTML = meetings.map(m => `
                <div class="meeting-item">
                    <div class="meeting-header">
                        <div class="meeting-title">${m.title}</div>
                        <button class="btn btn-danger" data-room="${roomName}" data-id="${m.id}">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                    <div class="meeting-info">
                        <div class="info-item">
                            <span class="info-icon">üë§</span>
                            <span><strong>‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô:</strong> ${m.chairman}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">üìÖ</span>
                            <span><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${formatShortDate(m.date)}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">üïê</span>
                            <span><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${m.timeStart} ‡∏ô.</span>
                        </div>
                    </div>
                    ${m.description ? `
                        <div class="meeting-description">
                            <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${m.description}
                        </div>
                    ` : ''}
                </div>
            `).join('');
            
            // Add delete listeners
            list.querySelectorAll('.btn-danger').forEach(btn => {
                btn.addEventListener('click', handleDeleteMeeting);
            });
        }

        function renderAllMeetings() {
            ROOMS.forEach(room => renderMeetings(room));
        }

        function renderSummary() {
            const container = document.getElementById('summaryContent');
            
            // Collect all meetings
            let allMeetings = [];
            ROOMS.forEach(room => {
                meetingsData[room].forEach(m => {
                    allMeetings.push({...m, room});
                });
            });
            
            if (allMeetings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìã</div>
                        <div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</div>
                    </div>
                `;
                return;
            }
            
            // Sort by date
            allMeetings.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.timeStart);
                const dateB = new Date(b.date + ' ' + b.timeStart);
                return dateA - dateB;
            });
            
            // Group by week
            const weeks = {};
            allMeetings.forEach(m => {
                const date = new Date(m.date);
                const week = getWeekNumber(date);
                const key = `${week.year}-W${week.week}`;
                
                if (!weeks[key]) {
                    weeks[key] = {
                        year: week.year,
                        week: week.week,
                        meetings: []
                    };
                }
                weeks[key].meetings.push(m);
            });
            
            // Render weeks
            const sortedWeeks = Object.keys(weeks).sort().reverse();
            
            container.innerHTML = sortedWeeks.map(key => {
                const w = weeks[key];
                const range = getWeekRange(w.year, w.week);
                
                // Group by date
                const byDate = {};
                w.meetings.forEach(m => {
                    if (!byDate[m.date]) byDate[m.date] = [];
                    byDate[m.date].push(m);
                });
                
                return `
                    <div class="week-section">
                        <div class="week-header">
                            <div class="week-title">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà ${w.week} (${range})</div>
                            <div class="week-count">${w.meetings.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                        </div>
                        ${Object.keys(byDate).sort().map(date => `
                            <div class="day-group">
                                <div class="day-title">${formatDate(date)}</div>
                                ${byDate[date].map(m => `
                                    <div class="summary-meeting">
                                        <div class="summary-meeting-header">
                                            <div class="summary-meeting-title">${m.title}</div>
                                            <div class="summary-room-badge">${m.room}</div>
                                        </div>
                                        <div class="meeting-info">
                                            <div class="info-item">
                                                <span class="info-icon">üïê</span>
                                                <span>${m.timeStart} ‡∏ô.</span>
                                            </div>
                                            <div class="info-item">
                                                <span class="info-icon">üë§</span>
                                                <span>${m.chairman}</span>
                                            </div>
                                        </div>
                                        ${m.description ? `
                                            <div class="meeting-description">
                                                ${m.description}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }

        // ==========================================
        // EVENT HANDLERS
        // ==========================================
        
        async function handleAddMeeting(e) {
            const btn = e.currentTarget;
            const room = btn.dataset.room;
            
            const title = document.getElementById(`title-${room}`).value.trim();
            const chairman = document.getElementById(`chairman-${room}`).value.trim();
            const date = document.getElementById(`date-${room}`).value;
            const hour = document.getElementById(`hour-${room}`).value;
            const minute = document.getElementById(`minute-${room}`).value;
            const description = document.getElementById(`desc-${room}`).value.trim();
            
            // Validate
            if (!title || !chairman || !date || !hour || !minute) {
                showAlert(room, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            const time = `${hour}:${minute}`;
            
            // Check overlap
            const overlap = checkOverlap(room, date, time);
            if (overlap) {
                showAlert(room, `‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ ${time} ‡∏ô. (${overlap.title})`, 'error');
                return;
            }
            
            // Show loading
            btn.disabled = true;
            btn.innerHTML = '<span>‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            
            try {
                await addMeeting(room, {
                    title,
                    chairman,
                    date,
                    timeStart: time,
                    description
                });
                
                // Clear form
                document.getElementById(`title-${room}`).value = '';
                document.getElementById(`chairman-${room}`).value = '';
                document.getElementById(`date-${room}`).value = '';
                document.getElementById(`hour-${room}`).value = '';
                document.getElementById(`minute-${room}`).value = '';
                document.getElementById(`desc-${room}`).value = '';
                
                showAlert(room, '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                setTimeout(() => clearAlert(room), 3000);
                
                renderAllMeetings();
                renderSummary();
                
            } catch (error) {
                showAlert(room, '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>‚ûï</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°';
            }
        }

        function handleDeleteMeeting(e) {
            const btn = e.currentTarget;
            const room = btn.dataset.room;
            const id = parseInt(btn.dataset.id);
            
            // Show modal
            const modal = document.getElementById('deleteModal');
            modal.classList.add('active');
            
            // Handle confirm
            const btnConfirm = document.getElementById('btnConfirm');
            const newBtn = btnConfirm.cloneNode(true);
            btnConfirm.parentNode.replaceChild(newBtn, btnConfirm);
            
            newBtn.addEventListener('click', async () => {
                modal.classList.remove('active');
                
                try {
                    await deleteMeeting(room, id);
                    showAlert(room, '‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    setTimeout(() => clearAlert(room), 3000);
                    
                    renderAllMeetings();
                    renderSummary();
                } catch (error) {
                    showAlert(room, '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                }
            });
            
            // Handle cancel
            document.getElementById('btnCancel').onclick = () => {
                modal.classList.remove('active');
            };
            
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            };
        }

        // ==========================================
        // TAB SWITCHING
        // ==========================================
        
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const target = tab.dataset.tab;
                
                // Update tabs
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update content
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`${target}-tab`).classList.add('active');
                
                if (target === 'summary') {
                    renderSummary();
                }
            });
        });

        // ==========================================
        // WEEK CALCULATIONS
        // ==========================================
        
        function getWeekNumber(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            const yearStart = new Date(d.getFullYear(), 0, 1);
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return { year: d.getFullYear(), week: weekNo };
        }

        function getWeekRange(year, week) {
            const simple = new Date(year, 0, 1 + (week - 1) * 7);
            const dow = simple.getDay();
            const start = new Date(simple);
            
            if (dow <= 4) {
                start.setDate(simple.getDate() - simple.getDay() + 1);
            } else {
                start.setDate(simple.getDate() + 8 - simple.getDay());
            }
            
            const end = new Date(start);
            end.setDate(start.getDate() + 6);
            
            const months = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.',
                           '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            
            const startStr = `${start.getDate()} ${months[start.getMonth()]}`;
            const endStr = `${end.getDate()} ${months[end.getMonth()]} ${end.getFullYear() + 543}`;
            
            return `${startStr} - ${endStr}`;
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================
        
        async function init() {
            const grid = document.getElementById('roomsGrid');
            grid.innerHTML = '<div class="loading"><div class="spinner"></div><div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div></div>';
            
            const success = await loadMeetings();
            
            if (success) {
                renderRooms();
            } else {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">‚ùå</div>
                        <div>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>
                    </div>
                `;
            }
        }

        // Start application
        init();
    </script>
</body>
</html>
