<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡∏†.‡∏à‡∏ß.‡∏™‡∏á‡∏Ç‡∏•‡∏≤ (Google Sheets)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', 'Segoe UI', Tahoma, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        .header h1 {
            color: #1e3c72;
            font-size: 2.2em;
            margin-bottom: 5px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .setup-notice {
            background: #fef3c7;
            color: #92400e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #f59e0b;
        }

        .setup-notice h3 {
            margin-bottom: 10px;
        }

        .setup-notice input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #f59e0b;
            border-radius: 5px;
            font-size: 1em;
        }

        .setup-notice button {
            background: #f59e0b;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1em;
        }

        .setup-notice button:hover {
            background: #d97706;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .room-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #1e3c72;
        }

        .room-name {
            font-size: 1.6em;
            font-weight: bold;
            color: #1e3c72;
        }

        .meeting-count {
            background: #1e3c72;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .add-meeting-form {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }

        .required {
            color: #ef4444;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-add {
            background: #10b981;
            color: white;
            width: 100%;
        }

        .btn-add:hover {
            background: #059669;
        }

        .btn-add:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
            padding: 8px 16px;
            font-size: 0.9em;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .meetings-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .meeting-item {
            background: #f8f9fa;
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 10px;
            border-left: 5px solid #1e3c72;
        }

        .meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .meeting-title {
            font-weight: bold;
            color: #1e3c72;
            font-size: 1.2em;
            flex: 1;
            margin-right: 10px;
        }

        .meeting-info {
            margin-bottom: 8px;
        }

        .info-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
            font-size: 0.95em;
            color: #555;
        }

        .info-icon {
            width: 20px;
            margin-right: 8px;
        }

        .meeting-description {
            font-size: 0.95em;
            color: #666;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
            line-height: 1.5;
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .summary-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1e3c72;
        }

        .summary-title {
            font-size: 2em;
            color: #1e3c72;
            font-weight: bold;
        }

        .day-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .day-header {
            font-size: 1.5em;
            color: #1e3c72;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e3c72;
        }

        .day-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            font-size: 0.95em;
            color: #666;
        }

        .summary-meeting-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #1e3c72;
        }

        .summary-meeting-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }

        .summary-meeting-title {
            font-weight: bold;
            color: #1e3c72;
            font-size: 1.1em;
        }

        .summary-room-badge {
            background: #1e3c72;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            white-space: nowrap;
        }

        .alert {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: bold;
            color: #ef4444;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-body {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-cancel {
            background: #6b7280;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }

        .btn-cancel:hover {
            background: #4b5563;
        }

        .btn-confirm-delete {
            background: #ef4444;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }

        .btn-confirm-delete:hover {
            background: #dc2626;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1e3c72;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.6em;
            }

            .rooms-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèõÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h1>
            <p>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏†‡∏π‡∏ò‡∏£‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏™‡∏á‡∏Ç‡∏•‡∏≤ (Google Sheets Version)</p>
        </div>

        <!-- Setup Notice -->
        <div class="setup-notice" id="setupNotice">
            <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
            <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App:</p>
            <input type="text" id="apiUrlInput" placeholder="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec">
            <button onclick="saveApiUrl()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL</button>
            <p style="margin-top: 10px; font-size: 0.9em;">
                <strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ URL ‡∏ô‡∏µ‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Deploy Google Apps Script ‡πÄ‡∏õ‡πá‡∏ô Web App
            </p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" id="tab-booking">üìÖ ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</button>
            <button class="tab-btn" id="tab-summary">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</button>
        </div>

        <div id="booking-tab" class="tab-content active">
            <div class="rooms-grid" id="roomsGrid"></div>
        </div>

        <div id="summary-tab" class="tab-content">
            <div class="summary-container">
                <div class="summary-header">
                    <div class="summary-title">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                </div>
                <div id="summaryContent"></div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal-overlay" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                ‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö
            </div>
            <div class="modal-body">
                ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btnCancelDelete">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn-confirm-delete" id="btnConfirmDelete">‡∏•‡∏ö</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        let API_URL = localStorage.getItem('googlesheet_api_url') || '';
        
        // Room names
        const rooms = [
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏°‡∏¥‡∏´‡∏•‡∏≤',
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°204',
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°3',
            '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°2'
        ];

        // Check if API URL is set
        if (API_URL) {
            document.getElementById('setupNotice').style.display = 'none';
        }

        // Save API URL
        function saveApiUrl() {
            const url = document.getElementById('apiUrlInput').value.trim();
            if (!url) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL');
                return;
            }
            
            localStorage.setItem('googlesheet_api_url', url);
            API_URL = url;
            document.getElementById('setupNotice').style.display = 'none';
            
            // Reload data
            loadAllMeetings();
        }

        // API Functions
        async function apiCall(action, data = {}) {
            if (!API_URL) {
                throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API URL ‡∏Å‡πà‡∏≠‡∏ô');
            }

            try {
                if (action === 'getAllMeetings') {
                    // Use GET for reading data
                    const response = await fetch(`${API_URL}?action=getAllMeetings`);
                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                    }
                    
                    return result.data;
                } else {
                    // Use POST for write operations
                    const payload = { action, ...data };
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload),
                        redirect: 'follow'
                    });

                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
                    }
                    
                    return result.data;
                }
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Database Manager Class
        class MeetingDatabase {
            constructor() {
                this.data = {};
                rooms.forEach(room => {
                    this.data[room] = [];
                });
            }

            async loadFromServer() {
                try {
                    const meetings = await apiCall('getAllMeetings');
                    
                    // Clear current data
                    rooms.forEach(room => {
                        this.data[room] = [];
                    });
                    
                    // Organize by room
                    if (Array.isArray(meetings)) {
                        meetings.forEach(meeting => {
                            if (this.data[meeting.room]) {
                                this.data[meeting.room].push(meeting);
                            }
                        });
                    }
                    
                    console.log('Data loaded from server:', this.data);
                    return true;
                } catch (error) {
                    console.error('Load error:', error);
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ' + error.message);
                    return false;
                }
            }

            async addMeeting(roomName, meeting) {
                try {
                    await apiCall('addMeeting', {
                        room: roomName,
                        title: meeting.title,
                        chairman: meeting.chairman,
                        date: meeting.date,
                        timeStart: meeting.timeStart,
                        description: meeting.description
                    });
                    
                    // Reload data
                    await this.loadFromServer();
                    return true;
                } catch (error) {
                    console.error('Add meeting error:', error);
                    throw error;
                }
            }

            async deleteMeeting(roomName, meetingId) {
                try {
                    await apiCall('deleteMeeting', {
                        id: meetingId,
                        room: roomName
                    });
                    
                    // Reload data
                    await this.loadFromServer();
                    return true;
                } catch (error) {
                    console.error('Delete meeting error:', error);
                    throw error;
                }
            }

            getMeetings(roomName) {
                return this.data[roomName] || [];
            }

            getAllMeetings() {
                const all = [];
                Object.keys(this.data).forEach(room => {
                    this.data[room].forEach(meeting => {
                        all.push({ ...meeting, room: room });
                    });
                });
                return all;
            }

            checkOverlap(roomName, date, timeStart) {
                const meetings = this.getMeetings(roomName);
                
                for (let meeting of meetings) {
                    if (meeting.date === date && meeting.timeStart === timeStart) {
                        return { overlap: true, meeting: meeting };
                    }
                }
                
                return { overlap: false };
            }
        }

        // Initialize database
        const db = new MeetingDatabase();

        // UI Manager
        class UIManager {
            static showAlert(roomName, message, type) {
                const alertDiv = document.getElementById(`alert-${roomName}`);
                if (!alertDiv) return;
                
                const alertClass = type === 'error' ? 'alert-error' : 'alert-success';
                alertDiv.innerHTML = `<div class="alert ${alertClass}">${message.replace(/\n/g, '<br>')}</div>`;
            }

            static clearAlert(roomName) {
                const alertDiv = document.getElementById(`alert-${roomName}`);
                if (alertDiv) {
                    alertDiv.innerHTML = '';
                }
            }

            static formatDate(dateStr) {
                const date = new Date(dateStr);
                const thaiDays = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
                const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô', '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', 
                                   '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
                
                return `‡∏ß‡∏±‡∏ô${thaiDays[date.getDay()]}‡∏ó‡∏µ‡πà ${date.getDate()} ${thaiMonths[date.getMonth()]} ${date.getFullYear() + 543}`;
            }

            static formatShortDate(dateStr) {
                const date = new Date(dateStr);
                const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', 
                                   '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
                return `${date.getDate()} ${thaiMonths[date.getMonth()]} ${date.getFullYear() + 543}`;
            }

            static showLoading(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                        </div>
                    `;
                }
            }
        }

        // Meeting Manager
        class MeetingManager {
            static async addMeeting(roomName) {
                const title = document.getElementById(`title-${roomName}`).value.trim();
                const chairman = document.getElementById(`chairman-${roomName}`).value.trim();
                const date = document.getElementById(`date-${roomName}`).value;
                const timeHour = document.getElementById(`time-hour-${roomName}`).value;
                const timeMinute = document.getElementById(`time-minute-${roomName}`).value;
                const description = document.getElementById(`desc-${roomName}`).value.trim();

                if (!title || !chairman || !date || !timeHour || !timeMinute) {
                    UIManager.showAlert(roomName, '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ *)', 'error');
                    return;
                }

                const timeStart = `${timeHour}:${timeMinute}`;

                const overlapCheck = db.checkOverlap(roomName, date, timeStart);
                if (overlapCheck.overlap) {
                    const om = overlapCheck.meeting;
                    UIManager.showAlert(
                        roomName, 
                        `‚ö†Ô∏è ‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!\n\n‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°: "${om.title}"\n‡πÄ‡∏ß‡∏•‡∏≤: ${om.timeStart} ‡∏ô.\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô`, 
                        'error'
                    );
                    return;
                }

                const meeting = {
                    title,
                    chairman,
                    date,
                    timeStart,
                    description
                };

                // Disable button
                const btn = document.querySelector(`[data-room-name="${roomName}"]`);
                btn.disabled = true;
                btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

                try {
                    await db.addMeeting(roomName, meeting);

                    // Clear form
                    document.getElementById(`title-${roomName}`).value = '';
                    document.getElementById(`chairman-${roomName}`).value = '';
                    document.getElementById(`date-${roomName}`).value = '';
                    document.getElementById(`time-hour-${roomName}`).value = '';
                    document.getElementById(`time-minute-${roomName}`).value = '';
                    document.getElementById(`desc-${roomName}`).value = '';

                    UIManager.showAlert(roomName, '‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    setTimeout(() => UIManager.clearAlert(roomName), 3000);

                    RoomRenderer.renderRoom(roomName);
                    SummaryRenderer.render();
                } catch (error) {
                    UIManager.showAlert(roomName, '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                } finally {
                    btn.disabled = false;
                    btn.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°';
                }
            }

            static async deleteMeeting(roomName, meetingId) {
                const modal = document.getElementById('deleteModal');
                const btnConfirm = document.getElementById('btnConfirmDelete');
                const btnCancel = document.getElementById('btnCancelDelete');
                
                modal.classList.add('active');
                
                const newBtnConfirm = btnConfirm.cloneNode(true);
                btnConfirm.parentNode.replaceChild(newBtnConfirm, btnConfirm);
                
                const newBtnCancel = btnCancel.cloneNode(true);
                btnCancel.parentNode.replaceChild(newBtnCancel, btnCancel);
                
                document.getElementById('btnConfirmDelete').addEventListener('click', async () => {
                    modal.classList.remove('active');
                    
                    try {
                        await db.deleteMeeting(roomName, meetingId);
                        
                        RoomRenderer.renderRoom(roomName);
                        SummaryRenderer.render();
                        UIManager.showAlert(roomName, '‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                        setTimeout(() => UIManager.clearAlert(roomName), 3000);
                    } catch (error) {
                        UIManager.showAlert(roomName, '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
                    }
                });
                
                document.getElementById('btnCancelDelete').addEventListener('click', () => {
                    modal.classList.remove('active');
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            }
        }

        // Room Renderer
        class RoomRenderer {
            static renderRoom(roomName) {
                const roomCard = document.querySelector(`[data-room="${roomName}"]`);
                if (!roomCard) return;
                
                const meetingsList = roomCard.querySelector('.meetings-list');
                const countBadge = roomCard.querySelector('.meeting-count');
                
                const roomMeetings = db.getMeetings(roomName);
                countBadge.textContent = `${roomMeetings.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

                if (roomMeetings.length === 0) {
                    meetingsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìÖ</div>
                            <div>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</div>
                        </div>
                    `;
                    return;
                }

                roomMeetings.sort((a, b) => {
                    const dateTimeA = new Date(a.date + ' ' + a.timeStart);
                    const dateTimeB = new Date(b.date + ' ' + b.timeStart);
                    return dateTimeA - dateTimeB;
                });

                meetingsList.innerHTML = roomMeetings.map(meeting => `
                    <div class="meeting-item">
                        <div class="meeting-header">
                            <div class="meeting-title">${meeting.title}</div>
                            <button class="btn btn-delete delete-meeting-btn" data-room-name="${roomName}" data-meeting-id="${meeting.id}">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                        <div class="meeting-info">
                            <div class="info-row">
                                <span class="info-icon">üë§</span>
                                <strong>‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô:</strong> ${meeting.chairman}
                            </div>
                            <div class="info-row">
                                <span class="info-icon">üìÖ</span>
                                <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${UIManager.formatShortDate(meeting.date)}
                            </div>
                            <div class="info-row">
                                <span class="info-icon">üïê</span>
                                <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${meeting.timeStart} ‡∏ô.
                            </div>
                        </div>
                        ${meeting.description ? `
                            <div class="meeting-description">
                                <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong><br>
                                ${meeting.description}
                            </div>
                        ` : ''}
                    </div>
                `).join('');

                meetingsList.querySelectorAll('.delete-meeting-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const roomName = this.getAttribute('data-room-name');
                        const meetingId = parseInt(this.getAttribute('data-meeting-id'));
                        MeetingManager.deleteMeeting(roomName, meetingId);
                    });
                });
            }

            static renderAll() {
                const roomsGrid = document.getElementById('roomsGrid');
                
                roomsGrid.innerHTML = rooms.map(room => `
                    <div class="room-card" data-room="${room}">
                        <div class="room-header">
                            <div class="room-name">${room}</div>
                            <div class="meeting-count">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                        </div>
                        
                        <div id="alert-${room}"></div>
                        
                        <div class="add-meeting-form">
                            <div class="form-group">
                                <label>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="required">*</span></label>
                                <input type="text" id="title-${room}" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°">
                            </div>
                            
                            <div class="form-group">
                                <label>‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° <span class="required">*</span></label>
                                <input type="text" id="chairman-${room}" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á">
                            </div>
                            
                            <div class="form-group">
                                <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span class="required">*</span></label>
                                <input type="date" id="date-${room}">
                            </div>
                            
                            <div class="form-group">
                                <label>‡πÄ‡∏ß‡∏•‡∏≤ <span class="required">*</span></label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <select id="time-hour-${room}">
                                        <option value="">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</option>
                                        ${Array.from({length: 24}, (_, i) => {
                                            const h = i.toString().padStart(2, '0');
                                            return `<option value="${h}">${h}</option>`;
                                        }).join('')}
                                    </select>
                                    <select id="time-minute-${room}">
                                        <option value="">‡∏ô‡∏≤‡∏ó‡∏µ</option>
                                        <option value="00">00</option>
                                        <option value="30">30</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</label>
                                <textarea id="desc-${room}" placeholder="‡∏ß‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°, ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°, ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏"></textarea>
                            </div>
                            
                            <button class="btn btn-add add-meeting-btn" data-room-name="${room}">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°
                            </button>
                        </div>
                        
                        <div class="meetings-list"></div>
                    </div>
                `).join('');

                roomsGrid.querySelectorAll('.add-meeting-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const roomName = this.getAttribute('data-room-name');
                        MeetingManager.addMeeting(roomName);
                    });
                });

                rooms.forEach(room => this.renderRoom(room));
            }
        }

        // Summary Renderer (same as before)
        class SummaryRenderer {
            static getWeekNumber(date) {
                const d = new Date(date);
                d.setHours(0, 0, 0, 0);
                d.setDate(d.getDate() + 4 - (d.getDay() || 7));
                const yearStart = new Date(d.getFullYear(), 0, 1);
                const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
                return { year: d.getFullYear(), week: weekNo };
            }

            static getWeekDateRange(year, week) {
                const simple = new Date(year, 0, 1 + (week - 1) * 7);
                const dow = simple.getDay();
                const ISOweekStart = simple;
                if (dow <= 4)
                    ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
                else
                    ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
                
                const weekEnd = new Date(ISOweekStart);
                weekEnd.setDate(ISOweekStart.getDate() + 6);
                
                return { start: ISOweekStart, end: weekEnd };
            }

            static formatWeekRange(startDate, endDate) {
                const thaiMonths = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', 
                                   '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
                
                const startDay = startDate.getDate();
                const startMonth = thaiMonths[startDate.getMonth()];
                const startYear = startDate.getFullYear() + 543;
                
                const endDay = endDate.getDate();
                const endMonth = thaiMonths[endDate.getMonth()];
                const endYear = endDate.getFullYear() + 543;
                
                if (startMonth === endMonth && startYear === endYear) {
                    return `${startDay}-${endDay} ${startMonth} ${startYear}`;
                } else if (startYear === endYear) {
                    return `${startDay} ${startMonth} - ${endDay} ${endMonth} ${startYear}`;
                } else {
                    return `${startDay} ${startMonth} ${startYear} - ${endDay} ${endMonth} ${endYear}`;
                }
            }

            static render() {
                const summaryContent = document.getElementById('summaryContent');
                
                let allMeetings = db.getAllMeetings();

                if (allMeetings.length === 0) {
                    summaryContent.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <div>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</div>
                        </div>
                    `;
                    return;
                }

                allMeetings.sort((a, b) => {
                    const dateTimeA = new Date(a.date + ' ' + a.timeStart);
                    const dateTimeB = new Date(b.date + ' ' + b.timeStart);
                    return dateTimeA - dateTimeB;
                });

                const groupedByWeek = {};
                allMeetings.forEach(meeting => {
                    const weekInfo = this.getWeekNumber(meeting.date);
                    const weekKey = `${weekInfo.year}-W${weekInfo.week}`;
                    
                    if (!groupedByWeek[weekKey]) {
                        groupedByWeek[weekKey] = {
                            year: weekInfo.year,
                            week: weekInfo.week,
                            meetings: []
                        };
                    }
                    groupedByWeek[weekKey].meetings.push(meeting);
                });

                const sortedWeeks = Object.keys(groupedByWeek).sort().reverse();

                let html = '';
                sortedWeeks.forEach(weekKey => {
                    const weekData = groupedByWeek[weekKey];
                    const weekRange = this.getWeekDateRange(weekData.year, weekData.week);
                    const weekRangeText = this.formatWeekRange(weekRange.start, weekRange.end);

                    html += `
                        <div class="day-section">
                            <div class="day-header">
                                ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà ${weekData.week} (${weekRangeText})
                            </div>
                            <div class="day-stats">
                                <span>üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°: <strong>${weekData.meetings.length}</strong> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                            </div>
                    `;

                    const meetingsByDate = {};
                    weekData.meetings.forEach(meeting => {
                        if (!meetingsByDate[meeting.date]) {
                            meetingsByDate[meeting.date] = [];
                        }
                        meetingsByDate[meeting.date].push(meeting);
                    });

                    Object.keys(meetingsByDate).sort().forEach(date => {
                        const dayMeetings = meetingsByDate[date];
                        html += `
                            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #e0e0e0;">
                                <div style="font-weight: bold; color: #1e3c72; margin-bottom: 10px;">
                                    ${UIManager.formatDate(date)}
                                </div>
                        `;
                        
                        dayMeetings.forEach(meeting => {
                            html += `
                                <div class="summary-meeting-item">
                                    <div class="summary-meeting-header">
                                        <div class="summary-meeting-title">${meeting.title}</div>
                                        <div class="summary-room-badge">${meeting.room}</div>
                                    </div>
                                    <div class="info-row">
                                        <span class="info-icon">üïê</span>
                                        <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${meeting.timeStart} ‡∏ô.
                                    </div>
                                    <div class="info-row">
                                        <span class="info-icon">üë§</span>
                                        <strong>‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô:</strong> ${meeting.chairman}
                                    </div>
                                    ${meeting.description ? `
                                        <div class="meeting-description">
                                            <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong><br>${meeting.description}
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });

                        html += `</div>`;
                    });

                    html += `</div>`;
                });

                summaryContent.innerHTML = html;
            }
        }

        // Tab switching
        document.getElementById('tab-booking').addEventListener('click', () => {
            document.getElementById('tab-booking').classList.add('active');
            document.getElementById('tab-summary').classList.remove('active');
            document.getElementById('booking-tab').classList.add('active');
            document.getElementById('summary-tab').classList.remove('active');
        });

        document.getElementById('tab-summary').addEventListener('click', () => {
            document.getElementById('tab-summary').classList.add('active');
            document.getElementById('tab-booking').classList.remove('active');
            document.getElementById('summary-tab').classList.add('active');
            document.getElementById('booking-tab').classList.remove('active');
            SummaryRenderer.render();
        });

        // Initialize and load data
        async function loadAllMeetings() {
            if (!API_URL) {
                console.log('API URL not set');
                return;
            }

            UIManager.showLoading('roomsGrid');
            
            const success = await db.loadFromServer();
            
            if (success) {
                RoomRenderer.renderAll();
                SummaryRenderer.render();
            } else {
                document.getElementById('roomsGrid').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">‚ùå</div>
                        <div>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API URL</div>
                    </div>
                `;
            }
        }

        // Start
        loadAllMeetings();
    </script>
</body>
</html>
